!function($){$.fn.images=function(){return this.each(function(){function e(){n.find(".add").removeClass("over"),n.find(".images-item").removeClass("over")}function i(){n.find(".images-item.selected").length?n.find(".imagesgrid").addClass("filled"):n.find(".imagesgrid").removeClass("filled"),n.find(".images-dropdown").removeClass("open"),n.find(".images-add-button").removeClass("open"),n.find(".images-dropdown a").not(".disabled").length>0?n.find(".images-dropdown .no-more-images").removeClass("da"):n.find(".images-dropdown .no-more-images").addClass("da")}function a(){n.find("input.images").val("").trigger("change"),n.find(".images-item.selected").length>1?(filenames=new Array,n.find(".images-item.selected").each(function(){filenames.push($(this).data("image"))}),filenames="- "+filenames.join("\n- "),n.find("input.images").val(filenames).trigger("change")):n.find("input.images").val(n.find(".images-item.selected").data("image")).trigger("change"),n.closest("form").trigger("keep")}function d(d){n.find(".images-item[data-image='"+d+"']").insertBefore(n.find(".add")).addClass("selected"),n.find(".images-dropdown a[data-filename='"+d+"']").addClass("disabled"),i(),a(),e()}function s(d){n.find(".images-item[data-image='"+d+"']").removeClass("selected"),n.find(".images-dropdown a[data-filename='"+d+"']").removeClass("disabled"),i(),e(),a()}var n=$(this),t="images";if(n.data("images"))return!0;n.data("images",!0),i(),n.find(".images-item .btn.remove").on("click",function(){if(!$(this).is(".ui-sortable-helper .btn")){s($(this).closest(".images-item").data("image"))}return!1}),n.find(".images-add-button").on("click",function(e){event.stopPropagation(),n.find(".images-dropdown").toggleClass("open"),n.find(".images-add-button").toggleClass("open"),$(document).click(function(e){0===$(e.target).closest(".images-dropdown").length&&(console.log($(e.target).closest(".images-dropdown").length),n.find(".images-dropdown").removeClass("open"),n.find(".images-add-button").removeClass("open"))})}),n.find(".images-dropdown a").on("click",function(e){d($(this).find(".image").text()),n.find(".images-dropdown").removeClass("open"),n.find(".images-add-button").removeClass("open")});var o=n.find(".imagesgrid"),l=o.find(".sortable"),r=o.find(".images-item"),m=o.data("api");l.find(".images-item").length>1&&l.sortable({tolerance:"pointer",revert:100,handle:"figure",items:".selected",update:function(){a()}}).disableSelection(),n.find(".field-content").droppable({tolerance:"pointer",hoverClass:"over",accept:function(e){return!!$(".sidebar").has(e).length||(!($(this).has(e).length||!e.hasClass("grid-item"))||void 0)},drop:function(e,i){n.find(".add").removeClass("over"),n.find(".images-item").removeClass("over");var a=i.draggable.data("helper");i.draggable.hasClass("grid-item")&&(otherField=i.draggable.closest(".field-with-images"),otherField.find(".images-add-button select option[data-filename='"+a+"']").removeAttr("disabled"),otherField.find(".selected").length<=2&&otherField.find(".imagesgrid").removeClass("filled"),i.draggable.removeClass("selected"),otherField.find("input.images").val(""),otherField.find(".images-item.selected").length>1?(filenames=new Array,otherField.find(".images-item.selected").each(function(){filenames.push($(this).data("image"))}),filenames="- "+filenames.join("\n- "),otherField.find("input.images").val(filenames)):otherField.find("input.images").val(otherField.find(".images-item.selected").data("image")),otherField.closest("form").trigger("keep")),d(a)},over:function(e,i){n.find(".imagesgrid").addClass("filled");var a=n.find(".images-item[data-image='"+i.draggable.data("helper")+"']");if(a.hasClass("selected"))a.addClass("over");else{var d=n.find(".images-item.selected figure");if(d.length)var s=d.height()-4;else{var t=n.find(".images-item").first();t.addClass("selected");var s=t.find("figure").height()-4;t.removeClass("selected")}n.find(".add .inner").height(s),n.find(".add").addClass("over")}},out:function(a,d){e(),i()}})})}}(jQuery);